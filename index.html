<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<title>Ranking VRINKA ‚Äì √öltimos 30 d√≠as</title>

<!-- Google Font Oxanium -->
<link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --c-principal:#FF007F;  /* magenta VRINKA */
    --c-secundario:#007BFF;
    --c-terciario:#9B00FF;
    --c-dark:#2C2C2C;
    --c-hi1:#97D700;
    --c-hi2:#FFDD00;
  }
  *{margin:0;padding:0;box-sizing:border-box;font-family:'Oxanium',Arial,Helvetica,sans-serif;}
  body {
    background: var(--c-dark);
    color: #fff;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    overflow-x: hidden;
  }
  .frame {
    width: 92vw;
    max-width: 1440px;
    padding: 2vh 0 4vh;
    display: flex;
    flex-direction: column;
    gap: 1vh;
    text-align: center;
  }
  h1{
    text-transform:uppercase;
    font-size:clamp(1.8rem, 2.8vw, 3.4rem);
    line-height:1.15;
    margin-bottom:0.5vh;
    color:var(--c-principal);
    letter-spacing:0.08em;
    text-shadow:0 0 8px var(--c-terciario);
  }
  table{
    width:100%;
    border-collapse:collapse;
    font-size:clamp(1rem, 2vw, 2.2rem);
    flex-grow:1;
  }
  th,td{padding:0.8vh 0.5vw;}
  th{
    font-size:clamp(1rem, 2.1vw, 2.3rem);
    font-weight:700;
    border-bottom:0.45vh solid var(--c-principal);
    height:6vh;               /* altura fija cabecera */
  }
  tr:nth-child(even){background:#222;}
  .highlight{
    background:var(--c-principal) !important;
    color:#000 !important;
    font-weight:700;
  }
  /* Alinear t√≠tulo de la columna Equipo a la izquierda */
  th:nth-child(2){
    text-align:left;
    padding-left:1vw;
  }
  /* Alinear nombre de equipo a la izquierda */
  td:nth-child(2){
    text-align:left;
    padding-left:1vw;
  }
  .medal{font-size:clamp(1.2rem, 2.2vw, 2.5rem);}
  .footer{font-size:clamp(1rem, 1.8vw, 2rem);color:var(--c-hi2);margin-top:1vh;}
  .footer button{
    font-size:clamp(1rem, 1.8vw, 2rem);
    background:transparent;
    border:0.2vw solid var(--c-principal);
    color:var(--c-hi2);
    border-radius:0.4vw;
    padding:0.2vw 0.8vw;
    cursor:pointer;
    margin:0 0.4vw;
  }
  .footer button:hover{
    background:var(--c-principal);
    color:#000;
  }
  /* Estilo para el bot√≥n cargar */
  #btnLoad{
    font-size:clamp(1rem, 1.8vw, 2rem);
    background:transparent;
    border:0.2vw solid var(--c-principal);
    color:var(--c-hi2);
    border-radius:0.4vw;
    padding:0.2vw 0.8vw;
    cursor:pointer;
    margin:0 0.4vw;
  }
  #btnLoad:hover{
    background:var(--c-principal);
    color:#000;
  }
  /* Altura fija de las filas para dar cabida siempre a 10 ‚Äî ajusta 8vh si ves huecos */
tbody tr {
  height: 7vh;
}
table {
  overflow: hidden;
}

table{
  overflow:hidden;
  max-height:80vh;            /* impide que tape la barra y el footer */
}
  #dateSelect {
      background: #000;
      color: var(--c-hi2);
      border: 0.2vw solid var(--c-principal);
      border-radius: 0.4vw;
      padding: 0.2vw 0.4vw;
      margin-left: 0.4vw;
      font-size: clamp(1rem, 1.8vw, 2rem);
      height: 2.8vw;
      font-weight: bold;
    }

  #teamSearch,
  #btnSearch {
    background: #000;
    color: var(--c-hi2);
    border: 0.2vw solid var(--c-principal);
    border-radius: 0.4vw;
    padding: 0.2vw 0.8vw;
    margin-left: 0.4vw;
    font-size: clamp(1rem, 1.8vw, 2rem);
  }

  #btnSearch:hover {
    background: var(--c-principal);
    color: #000;
    cursor: pointer;
  }
  /* Corrige la alineaci√≥n de los controles del reproductor en escritorio */
  .player-controls {
    display: flex;
    align-items: center;
    gap: 1vw;
  }
  .control-icon {
    height: 2.5vh;
    object-fit: contain;
  }
  .control-btn {
    background: transparent;
    border: none;
    cursor: pointer;
    width: 4vh;
    height: 4vh;
    padding: 0;
  }
  @media screen and (max-width: 768px) {
    /* Reducir el gap del contenedor superior para m√≥viles */
    div[style*="gap: 2vw"] {
      gap: 0.8vw !important; /* Reducido para m√°s compacidad */
    }
    body {
      padding: 0;
      margin: 0;
      width: 100vw;
    }

    .frame {
      width: 100vw;
      padding-left: 0;
      padding-right: 0;
      padding-top: 1vh;
      padding-bottom: 3vh;
    }

    h1 {
      font-size: clamp(2.5rem, 6vw, 7rem);
    }

    table {
      width: 100%;
      font-size: clamp(1.5rem, 4.5vw, 5.2rem);
      table-layout: fixed;
    }
    th:nth-child(1), td:nth-child(1) {
      width: 10vw;
      text-align: center;
    }
    th:nth-child(2), td:nth-child(2) {
      width: 50vw;
    }
    th:nth-child(3), td:nth-child(3),
    th:nth-child(4), td:nth-child(4) {
      width: 20vw;
      text-align: right;
      padding-right: 2vw;
    }

    th {
      font-size: clamp(1.2rem, 3.5vw, 4rem);
    }

    .medal {
      font-size: clamp(2rem, 5vw, 6rem);
    }

    /* Men√∫ superior: tama√±o y consistencia visual en m√≥viles */
    #dateSelect,
    #teamSearch,
    #btnSearch,
    #settingsButton {
      font-size: clamp(1.2rem, 3.2vw, 3.8rem); /* Tama√±o de fuente m√°s reducido */
      padding: 0.8vw 1.8vw; /* Padding reducido */
      border: 0.4vw solid var(--c-principal);
      border-radius: 1vw;
      height: auto; /* Altura autom√°tica basada en padding */
      font-weight: normal; /* Quitamos la negrita */
    }

    #teamSearch {
      width: 100%; /* El campo de texto ocupa todo el espacio de su contenedor (label) */
    }

    /* Nuevas reglas para forzar el layout en m√≥vil */
    #dateSelect, .search-controls, .player-controls {
      flex-basis: 100%;
      display: flex;
      justify-content: center;
      margin-bottom: 2vw;
      align-items: center;
    }
    #dateSelect, .search-controls {
      width: 90%;
      margin-left: auto;
      margin-right: auto;
    }
    .search-controls {
      justify-content: flex-start; /* Alinea el input y el bot√≥n a la izquierda */
    }
    .search-controls, .player-controls { /* .player-controls mantiene el centrado de la regla general */
      gap: 2vw;
    }
    .search-controls > label {
      flex-grow: 1; /* El label (contenedor del input) se expande */
    }
    #settingsButton {
      line-height: 1;
    }

    .control-btn {
      width: 7vw;
      height: 7vw;
    }

    #btnLoad,
    .footer button {
      font-size: clamp(1.5rem, 4vw, 5rem);
      padding: 1vw 2vw;
    }

    #footerContent {
      min-width: 60vw !important;
    }

    td:nth-child(2) {
      word-wrap: break-word;
      font-size: clamp(1rem, 3vw, 3.5rem);
    }

    td:nth-child(3) {
      font-size: clamp(1rem, 3vw, 3.5rem);
    }

    td:nth-child(3), td:nth-child(4) {
      text-align: right;
      padding-right: 2vw;
    }

    /* Reducir tama√±o de la fuente exclusivamente de la fecha en m√≥vil */
    td:nth-child(4) {
      font-size: clamp(0.8rem, 2.5vw, 2.8rem);
    }
  }
  </style>
  <style>
#footerUpdate {
  color: #fff;
}
</style>
</head>

<body>
<div style="width: 100%; background: #000; z-index: 999; display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 2vw; padding: 1.2vh 1vw 0 1vw; margin-bottom: 2vh;">
  <select id="dateSelect">
    <option value="all">Absoluto</option>
    <option value="today">Hoy</option>
    <option value="last30" selected>√öltimos 30 d√≠as</option>
  </select>
  <div class="search-controls">
    <label>
      <input type="text" id="teamSearch" placeholder="Nombre de equipo">
    </label>
    <button id="btnSearch">Buscar</button>
  </div>
  <div class="player-controls">
    <div style="position:relative; display:inline-block;">
      <button id="settingsButton" onclick="toggleFooter()" style="font-size:1.8vw; background:transparent; border:0.2vw solid var(--c-principal); color:var(--c-hi2); border-radius:0.4vw; padding:0.2vw 0.8vw; cursor:pointer;">
        ‚öôÔ∏è
      </button>
      <div id="footerContent" style="display:none; position:absolute; top:100%; right:0; background:#111; padding:2vh 2vw; border:0.2vw solid var(--c-principal); border-radius:0.4vw; z-index:9999; min-width:22vw;">
        <label style="margin-left:0; font-size:1.5vw;">
          <input type="checkbox" id="chkHighlight" checked>
          Marcar √∫ltima partida
        </label>
        <input type="file" id="fileLoader" accept=".json" style="display:none;">
        <button id="btnLoad">Cargar datos</button>
      </div>
    </div>
    <div style="display: flex; align-items: center; gap: 0.5vw;">
      <button id="btnPlayPause" class="control-btn" aria-label="Pausa/Reanudar">
        <img id="playPauseIcon" src="icon_pause.png" alt="Pausa" class="control-icon" />
      </button>
      <button id="btnNext" class="control-btn" aria-label="Siguiente juego">
        <img src="icon_forward.png" alt="Siguiente" class="control-icon" />
      </button>
    </div>
  </div>
  <div style="width: 100%; height: 0.6vh; background: #111; position: relative;">
    <div id="progressBar" style="width: 0%; height: 100%; background: var(--c-principal); transition: width 0.1s linear;"></div>
  </div>
</div>
<div class="frame">
  <div style="display: flex; align-items: center; justify-content: center; padding: 0 1vw;">
    <div style="display: flex; justify-content: center; align-items: center; text-align: center;">
      <h1 id="title" style="margin: 0;">Cargando‚Ä¶</h1>
    </div>
  </div>
  <table id="ranking"></table>
  <!-- Footer eliminado porque su contenido fue movido arriba -->
  <div id="footerUpdate" class="footer"></div>
</div>

<!-- ===== Script ES5 compatible ===== -->
<script>
// Temporizador deshabilitado: variables eliminadas

var CYCLE_SECONDS = 15;
var NOW = new Date();
var MS_30D = 30 * 24 * 60 * 60 * 1000;

// === TEMPORIZADOR Y PROGRESO ===
var isPlaying = true;
var timer = null;
var progress = 0;
var lastTick = null;
var progressBar = null;
var playPauseIcon = null;

window.addEventListener('DOMContentLoaded', function() {
  progressBar = document.getElementById('progressBar');
  playPauseIcon = document.getElementById('playPauseIcon');
  updatePlayPauseIcon();
  // startTimer(); // Elimino el inicio autom√°tico aqu√≠
});

function startTimer() {
  if (timer) clearInterval(timer);
  isPlaying = true;
  updatePlayPauseIcon();
  lastTick = Date.now();
  timer = setInterval(function() {
    if (!isPlaying) return;
    var now = Date.now();
    var elapsed = (now - lastTick) / 1000;
    lastTick = now;
    progress += (elapsed / CYCLE_SECONDS) * 100;
    if (progress >= 100) {
      progress = 0;
      nextGame();
    }
    updateProgressBar();
  }, 50);
}

function stopTimer() {
  isPlaying = false;
  updatePlayPauseIcon();
}

function resetTimer() {
  progress = 0;
  updateProgressBar();
  lastTick = Date.now();
}

function updateProgressBar() {
  if (!progressBar) progressBar = document.getElementById('progressBar');
  progressBar.style.width = Math.min(progress, 100) + '%';
}

function updatePlayPauseIcon() {
  if (!playPauseIcon) playPauseIcon = document.getElementById('playPauseIcon');
  if (isPlaying) {
    playPauseIcon.src = 'icon_pause.png';
    playPauseIcon.alt = 'Pausa';
  } else {
    playPauseIcon.src = 'icon_play.png';
    playPauseIcon.alt = 'Play';
  }
}

// Bot√≥n play/pausa
if (document.getElementById('btnPlayPause')) {
  document.getElementById('btnPlayPause').onclick = function(){
    if (isPlaying) {
      stopTimer();
    } else {
      isPlaying = true;
      updatePlayPauseIcon();
      lastTick = Date.now();
    }
  };
}

// Bot√≥n siguiente
if (document.getElementById('btnNext')) {
  document.getElementById('btnNext').onclick = function(){
    nextGame();
    resetTimer(); // Solo reinicia progreso, no cambia estado play/pausa
  };
}

// Asignar eventos solo si los elementos existen
if (dateSelector) {
  dateSelector.onchange = function(){
    rebuildByGame();
    resetTimer(); // Solo reinicia progreso, no cambia estado play/pausa
  };
}
if (chkHighlight) {
  chkHighlight.onchange = function(){
    highlightLast = this.checked;
    render();
    resetTimer(); // Solo reinicia progreso, no cambia estado play/pausa
  };
}

// Al cambiar de juego manualmente
function nextGame(){
  if (!games.length) return;
  idx = (idx + 1) % games.length;
  render();
  resetTimer(); // Solo reinicia progreso, no cambia estado play/pausa
}

var currentRaw = [];
var dateSelector = document.getElementById('dateSelect');
var chkHighlight = document.getElementById('chkHighlight');
var highlightLast = false;
if (chkHighlight) {
  // Si estamos en la ventana principal (no embebida), leer el estado del checkbox
  highlightLast = (window === window.top) ? chkHighlight.checked : false;
}
// var chkHighlight  = document.getElementById('chkHighlight');


  (function fillMonths(){
    var now = new Date();
    for(var i=0;i<12;i++){
      var d = new Date(now.getFullYear(), now.getMonth()-i, 1);
      var val = d.toISOString().slice(0,7);
      var txt = d.toLocaleString('es-ES',{month:'long',year:'numeric'});
      var opt = document.createElement('option');
      opt.value = val;
      opt.textContent = txt.charAt(0).toUpperCase()+txt.slice(1);
      dateSelector.appendChild(opt);
    }
  })();

  (function fillYears(){
    var startYear = 2024;
    var currentYear = new Date().getFullYear();
    for(var y = currentYear; y >= startYear; y--){
      var opt = document.createElement('option');
      opt.value = 'year-' + y;      // e.g., year-2025
      opt.textContent = y.toString();
      dateSelector.appendChild(opt);
    }
  })();

function inRange(dateObj){
    var sel = dateSelector.value;

    if(sel === 'all'){                 // sin filtro: todos los datos
      return true;
    }
    if(sel === 'today'){               // hoy
      return dateObj.getFullYear() === NOW.getFullYear() &&
             dateObj.getMonth() === NOW.getMonth() &&
             dateObj.getDate() === NOW.getDate();
    }
    if(sel === 'last30'){              // √∫ltimos 30 d√≠as
      return (NOW - dateObj) <= MS_30D;
    }
    if(sel.startsWith('year-')){       // filtro por a√±o completo
      var yearSel = parseInt(sel.split('-')[1], 10);
      return dateObj.getFullYear() === yearSel;
    }
    // filtro por mes YYYY-MM (opciones a√±adidas por fillMonths)
    return dateObj.toISOString().slice(0,7) === sel;
  }

function parseJSONDate(str){
  return new Date(str.replace(' ', 'T'));
}
function daysAgo(date){
  return NOW - date;
}

// --- Muevo la funci√≥n render aqu√≠ antes de rebuildByGame ---
function render(){
  var pair = games[idx];
  var game = pair[0];
  var rows = pair[1];

  titleEl.textContent = game.toUpperCase();

  /* partida m√°s reciente registrada para ese juego */
  var lastRecent = null;
  for(var i=0;i<rows.length;i++){
    if(!lastRecent || new Date(rows[i].date) > new Date(lastRecent.date)){
      lastRecent = rows[i];
    }
  }

  var top10 = rows.slice(0, 10);

  if (highlightLast && lastRecent && top10.indexOf(lastRecent) === -1) {
    top10.pop();              // elimina el puesto 10 actual
    top10.push(lastRecent);   // a√±ade la √∫ltima partida
  }

  /* construir tabla: siempre 10 filas */
  var isMobile = window.innerWidth <= 768;
  var thScore = isMobile ? 'Puntos' : 'Puntuaci√≥n';
  var thDate  = isMobile ? 'D√≠a' : 'Fecha';
  var html = '<tr><th class="medal">#</th><th>Equipo</th><th>' + thScore + '</th><th>' + thDate + '</th></tr>';

  for (var rowIdx = 0; rowIdx < 10; rowIdx++) {
    var r = (rowIdx < top10.length) ? top10[rowIdx] : null;
    var posReal = rows.indexOf(r) + 1;
    var showPos = (highlightLast && (r === lastRecent) && posReal > 10)
                  ? posReal
                  : (rowIdx + 1);

    var medal = (showPos===1)?'ü•á'
             : (showPos===2)?'ü•à'
             : (showPos===3)?'ü•â'
             : showPos;
    if (r) {
      var isCurrent = highlightLast && (r === lastRecent);
      html += '<tr class="' + (isCurrent ? 'highlight' : '') + '"><td class="medal">' + medal + '</td>' +
              '<td>' + r.teamName + '</td>' +
              '<td>' + r.score.toLocaleString("es-ES") + '</td>' +
              '<td>' + r.date.slice(8,10) + '-' + r.date.slice(5,7) + '-' + r.date.slice(2,4) + '</td></tr>';
    } else {
      html += '<tr><td class="medal">' + medal + '</td><td></td><td></td><td></td></tr>';
    }
  }
  rankingEl.innerHTML = html;
}
// --- Fin de mover render ---

function getLastUpdateDate(){
  if (!currentRaw || !currentRaw.length) return null;
  var last = currentRaw.reduce(function(max, r){
    var d = parseJSONDate(r.date);
    return (!max || d > max) ? d : max;
  }, null);
  return last;
}

function updateFooterDate(){
  var el = document.getElementById('footerUpdate');
  if (!el) return;
  var last = getLastUpdateDate();
  if (!last) {
    el.textContent = '';
    return;
  }
  var opts = { day: '2-digit', month: 'long', year: 'numeric' };
  var fecha = last.toLocaleDateString('es-ES', opts);
  el.textContent = '√öltima actualizaci√≥n: ' + fecha;
}

/* Re-filtra y agrupa los datos seg√∫n dateSelect */
function rebuildByGame(){
  var currentGameName = (games[idx] && games[idx][0]) ? games[idx][0] : null;

  var byGame = {};
  currentRaw.forEach(function(r){
    if (!r.game || !r.game.trim()) return;
    var gName = r.game.trim();
    var d = parseJSONDate(r.date);
    if(!inRange(d)) return;          // aplica filtro
    if(!byGame[gName]) byGame[gName] = [];
    byGame[gName].push(r);
  });
  Object.keys(byGame).forEach(function(g){
    byGame[g].sort(function(a,b){ return b.score - a.score; });
  });

  // Si el juego actual no est√° en el rango, a√±√°delo vac√≠o
  if (currentGameName && !byGame[currentGameName]) {
    byGame[currentGameName] = [];
  }

  games = Object.keys(byGame).map(function(k){ return [k, byGame[k]]; });

  if (!games.length) {
    rankingEl.innerHTML =
      '<tr><th class="medal">#</th><th>Equipo</th><th>Puntuaci√≥n</th><th>Fecha</th></tr>';
    titleEl.textContent = 'SIN DATOS RECIENTES';
    stopTimer(); // Detener temporizador si no hay juegos
    return;
  }

  idx = games.findIndex(pair => pair[0] === currentGameName);
  if (idx === -1) idx = 0;

  render();
  resetTimer(); // Solo reinicia progreso, no cambia estado play/pausa
  // Mantener el estado anterior del temporizador (play o pausa)
  updatePlayPauseIcon();
  lastTick = Date.now();
  if (!timer) startTimer();
  updateFooterDate();
}

fetch('hz-scores.json')
  .then(function(r){ return r.json(); })
  .then(function(raw){
    currentRaw = raw;
    rebuildByGame();
    updateFooterDate();
  })
  .catch(function(err){
    console.error("Error cargando JSON por defecto:", err);
  });

var rankingEl = document.getElementById('ranking');
var titleEl   = document.getElementById('title');
// var progress = document.getElementById('progress');
var games     = [];
var idx       = 0;

/* ==== PROGRESS BAR ANIMATION ==== */
// startLoop y stopLoop eliminadas
</script>
<script>
if (window !== window.top) {
  // P√°gina embebida
  const logo = document.getElementById('vrinkaLogo');
  if (logo) logo.style.display = 'none';

  const options = document.getElementById('settingsButton');
  if (options) options.style.display = 'none';

  // Si est√° embebida, no mostrar la opci√≥n "Hoy"
  const todayOption = document.querySelector('#dateSelect option[value="today"]');
  if (todayOption) {
    todayOption.remove();
  }

  // Evitar scroll vertical en la p√°gina embebida
  document.body.style.overflowY = 'hidden';
}
</script>
<script>
function toggleFooter(){
  var el = document.getElementById('footerContent');
  var isVisible = el.style.display === 'block';
  el.style.display = isVisible ? 'none' : 'block';

  if (!isVisible) {
    setTimeout(() => {
      document.addEventListener('click', outsideClickListener);
    }, 0);
  }
}

function outsideClickListener(event) {
  var menu = document.getElementById('footerContent');
  var button = event.target.closest('button[onclick="toggleFooter()"]');
  if (!menu.contains(event.target) && !button) {
    menu.style.display = 'none';
    document.removeEventListener('click', outsideClickListener);
  }
}
</script>
<script>
document.getElementById('btnNext').onclick = function(){
  nextGame();
};
dateSelector.onchange = function(){
  if (this.value === 'today') {
    if (chkHighlight) {
      chkHighlight.checked = false;
      // highlightLast = chkHighlight.checked;
    }
  }
  rebuildByGame();
};
if (chkHighlight) chkHighlight.onchange = function(){
  highlightLast = this.checked;
  render();
};

// --- Cargar JSON desde archivo local ---
var fileInput = document.getElementById('fileLoader');
document.getElementById('btnLoad').onclick = function(){
  fileInput.click();              // abre di√°logo
};
fileInput.onchange = function(evt){
  var file = evt.target.files[0];
  if(!file) return;
  var reader = new FileReader();
  reader.onload = function(e){
    try{
      var data = JSON.parse(e.target.result);
      currentRaw = data;
      rebuildByGame();
      updateFooterDate();
    }catch(err){
      alert("JSON inv√°lido");
    }
  };
  reader.readAsText(file, "utf-8");
  // limpia para poder volver a seleccionar el mismo archivo despu√©s
  this.value = '';
};
// ----------------------------------------

document.getElementById('btnSearch').onclick = function(){
  var input = document.getElementById('teamSearch').value.trim();
  if(!input){
    alert("Introduce un nombre de equipo.");
    return;
  }
  var normalizedInput = input.replace(/\s+/g, ' ').toLowerCase();

  var result = [];
  games.forEach(function(pair){
    var game = pair[0];
    var rows = pair[1];
    var gameResults = [];
    for (var i = 0; i < rows.length; i++) {
      var normalizedTeamName = rows[i].teamName.trim().replace(/\s+/g, ' ').toLowerCase();
      if (normalizedTeamName === normalizedInput) {
        gameResults.push({
          position: i + 1,
          score: rows[i].score,
          date: rows[i].date
        });
      }
    }
    if (gameResults.length > 0) {
      var gameTitle = '<strong style="text-align:left; display:block;">' + game + '</strong>';
      var detailsHtml = gameResults.map(function(res) {
        var formattedDate = res.date.slice(8,10) + '-' + res.date.slice(5,7) + '-' + res.date.slice(2,4);
        var mainInfo = '- Puesto ' + res.position + ' (' + res.score.toLocaleString('es-ES') + ' pts)';
        return '<div style="font-size: 0.9em; text-align: left; padding-left: 1em; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0 1em; line-height: 1.4;">' +
               '<span>' + mainInfo + '</span>' +
               '<span style="opacity: 0.8; white-space: nowrap;">' + formattedDate + '</span>' +
               '</div>';
      }).join('');
      result.push(gameTitle + detailsHtml);
    }
  });

  if(result.length){
    const title = `Posiciones de "${input.toUpperCase()}"`;
    const body = result.join('<hr style="border:none; border-top: 1px solid #555; margin: 1vh 0;">');
    // Remove existing popup if present
    var existingPopup = document.getElementById('popupSearchResult');
    if (existingPopup) existingPopup.remove();

    const popup = document.createElement('div');
    popup.id = 'popupSearchResult';
    popup.style.position = 'fixed';
    popup.style.left = '50%';
    popup.style.transform = 'translateX(-50%)';
    if (window.innerWidth <= 768) {
      popup.style.width = '80vw';
      popup.style.top = '25vh';
    } else {
      popup.style.top = '8vh';
      popup.style.maxWidth = '50vw';
    }
    popup.style.background = '#000';
    popup.style.border = '2px solid #FF007F';
    popup.style.color = '#FFDD00';
    popup.style.padding = '2vh 4vw';
    popup.style.fontSize = 'clamp(1.2rem, 4vw, 2rem)';
    popup.style.textAlign = 'center';
    popup.style.zIndex = 9999;
    popup.style.boxShadow = '0 0 1vw #FF007F';
    popup.style.borderRadius = '1vw';
    popup.innerHTML = `<div style="margin-bottom:1vh;font-weight:bold;">${title}</div>${body}<div style="margin-top:2vh;"><button id="popupClose" style="font-size:clamp(1rem, 3.5vw, 1.8rem);padding:0.5vh 2vw;border:none;border-radius:0.5vw;background:#FF007F;color:#000;cursor:pointer;">Cerrar</button></div>`;
    document.body.appendChild(popup);
    document.getElementById('popupClose').onclick = function(){
      popup.remove();
    };
  } else {
    alert(`No se ha encontrado el equipo "${input.toUpperCase()}" en ning√∫n juego.`);
  }
};

// Permitir b√∫squeda con la tecla Enter en el campo de b√∫squeda
document.getElementById('teamSearch').addEventListener('keydown', function(event) {
  if (event.key === 'Enter') {
    event.preventDefault(); // Prevent form submission or unexpected behavior
    document.getElementById('btnSearch').click();
  }
});
</script>
</body>
</html>